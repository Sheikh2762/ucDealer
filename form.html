<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" type="text/css" href="form.css">
  <title>UC Purchase Form</title>
</head>
<body>
  <h2>Buy UC</h2>
  <form id="ucForm">
    <label>Name:</label><br>
    <input type="text" id="name" required><br><br>

    <label>UID:</label><br>
    <input type="text" id="uid" required><br><br>

    <label>In-Game Name:</label><br>
    <input type="text" id="ign" required><br><br>

    <label>Email (optional):</label><br>
    <input type="email" id="email"><br><br>

    <!-- Hidden inputs for package info -->
    <input type="hidden" id="package">
    <input type="hidden" id="price">

    <button type="submit">Submit & Proceed to Payment</button>
  </form>

  <!-- Firebase SDKs -->
  <script type="module">
    // ✅ Import Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    // ✅ Firebase config (apna config paste karein)
    const firebaseConfig = {
      apiKey: "AIzaSyAm5Ylwg2h_BRifRY0vRanLwC6Eb_v_nno",
    authDomain: "ucdealer-e49fd.firebaseapp.com",
    projectId: "ucdealer-e49fd",
    storageBucket: "ucdealer-e49fd.firebasestorage.app",
    messagingSenderId: "795869297198",
    appId: "1:795869297198:web:f3887da1a55a17e9cdfdbf",
    measurementId: "G-CWL0SBEHGY"
    };

    // ✅ Initialize Firebase + Firestore
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ✅ Get package info from query params
    const params = new URLSearchParams(window.location.search);
    document.getElementById("package").value = params.get("package");
    document.getElementById("price").value = params.get("price");

    // ✅ Form submit
    document.getElementById("ucForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const name = document.getElementById("name").value;
      const uid = document.getElementById("uid").value;
      const ign = document.getElementById("ign").value;
      const email = document.getElementById("email").value;
      const packageName = document.getElementById("package").value;
      const price = document.getElementById("price").value;

      try {
        // Firestore me add
        const docRef = await addDoc(collection(db, "orders"), {
          name,
          uid,
          ign,
          email,
          package: packageName,
          price,
          status: "pending",
          createdAt: serverTimestamp()
        });

        // Payment page pe redirect
        window.location.href = `payment.html?orderId=${docRef.id}&package=${encodeURIComponent(packageName)}&price=${encodeURIComponent(price)}`;
      } catch (error) {
        alert("Error: " + error.message);
      }
    });
  </script>
</body>
</html>
